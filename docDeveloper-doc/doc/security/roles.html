<!-- Htmldoc has been run -->
<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<link rel='stylesheet' href='module://docDeveloper/rc/sunlight.default.css'>
<!-- Auto-generated style sheet link --><link rel='StyleSheet' href='module://bajaui/doc/style.css' type='text/css' />
<!-- Auto-generated js link for Activity Monitoring --><script type='text/javascript' src='module://web/rc/util/activityMonitor.js'></script>
<script type='text/javascript'>window.addEventListener('load', activityMonitor.start);</script>
</head>
<body>
<!-- Auto-generated Header NavBar --><p class="navbar">  <a href="/doc/index.html" class="navbar">Index</a> |  <a href="/doc/security/authentication.html" class="navbar">Prev</a> |  <a href="/doc/security/headerAuthentication.html" class="navbar">Next</a></p>

<script type='text/javascript' src='module://docDeveloper/rc/sunlight-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.java-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.javascript-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.xml-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.css-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/niagara-sunlight-support.js'></script>

<h1 id="roles">Roles</h1>
<h1 id="overview">Overview</h1>
<p>Niagara 4 introduces the use of roles for managing user access to the various components in a station. Rather than setting permissions directly on a <code>BUser</code>, permissions are assigned to <code>BRole</code>s, which are in turn assigned to <code>BUser</code>s.</p>
<p>In this document, we will go over:</p>
<ul>
  <li><a href="#roles">Role Based Access Control</a></li>
  <li><a href="#api">Niagara AX to Niagara 4 API Changes</a></li>
</ul>
<p><a name="roles"></a></p>
<h1 id="role-based-access-control">Role Based Access Control</h1>
<h2 id="overview">Overview</h2>
<p>Roles add a layer of abstraction between Users and PermissionsMaps to allow the reuse of PermissionsMaps between multiple users. The permissions of all users that have a role can now be managed in one place instead of updating multiple users. If there are 40 operators that need access to a new component in the station, only their shared operator role will need to be updated. The amount of initial configuration may be slightly higher in some configurations, however there is a trade off to save future configuration time that would be spent updating the permissions of multiple users.</p>
<p>Take the example &lsquo;roleDemo&rsquo; station. This station is an example of how permissions of a sprint team can be modeled using roles instead of individual user permissions. Note that the categories (define collections of objects) still must be defined.</p>
<p><img src="roles_navTree.png" alt="Important Services" title="Important Services" /></p>
<h2 id="categories">Categories</h2>
<p>The security configuration of a Niagara station starts with the definition of categories. A category is simply a collection of Niagara objects.</p>
<p><img src="roles_categoryBrowser.png" alt="Category Browser" title="Category Browser" /></p>
<h2 id="roles">Roles</h2>
<p>Once the lists of objects to secure are defined into categories, permissions must be granted to Roles (this used to be done on the BUser).</p>
<p>Product Owners get to access everything under the sprint team, so let&rsquo;s assign all permissions on all the categories we defined.</p>
<p><img src="roles_permissionMap.png" alt="Role Permissions" title="Role Permissions" /></p>
<h2 id="users">Users</h2>
<p>Now that we have defined the permissions of Roles we can associate users with those roles.</p>
<p>Let&rsquo;s take a look at Blake&rsquo;s permissions in the Sprint Team:</p>
<p><img src="roles_userPropSheet.png" alt="User Property Sheet" title="User Property Sheet" /></p>
<p>As you can see, Blake has all of the roles except for the &lsquo;Product Owner&rsquo; Role. So when Blake logs into the station the only folder he does not have access to is the &lsquo;Product Owner&rsquo; folder.</p>
<p>Just for reference here are all of the objects visible to each user:</p>
<p><img src="roles_treeComparison1.png" alt="Objects Visible to Each User" title="Objects Visible to Each User" /></p>
<h2 id="reuse">Reuse</h2>
<p>So far this has been as much work as in previous releases. Now it is time for the payoff. Let&rsquo;s make Mike the Scrum Master.</p>
<p><img src="roles_addRole.png" alt="Add Role" title="Add Role" /></p>
<p>Blake might need a break, so let&rsquo;s uncheck the Bad Horse Scrum Master role in his Property Sheet.</p>
<p><img src="roles_removeRole.png" alt="Remove Role" title="Remove Role" /></p>
<p>Then we can compare their views of the Bad Horse Folders:</p>
<p><img src="roles_treeComparison2.png" alt="Objects Visible to Each User" title="Objects Visible to Each User" /></p>
<p>So without harming any maps of permissions or altering categories of objects we updated the roles of current users.</p>
<p><a name="api"></a></p>
<h1 id="niagara-ax-to-niagara-4-api-changes">Niagara AX to Niagara 4 API Changes</h1>
<p>Due to the changes to use Roles rather than permissions directly on the users, some changes have been made to the API.</p>
<h2 id="who-is-impacted">Who is Impacted</h2>
<p>Developers who interact or set a <code>BUser</code>&rsquo;s <code>BPermissionsMap</code> directly will need to update their programs to manage a set of <code>BRole</code> objects instead.</p>
<h2 id="resolution">Resolution</h2>
<p>The addition of roles is intended to ease managing the permissions of a large numbers of users. The permissions of a group of users (who are assigned to the same role) can be updated by changing one role&rsquo;s permissions instead of updating each user&rsquo;s permissions individually. In order to take advantage of the new functionality, code that currently manages a single user&rsquo;s permissions will need to be updated to assign roles to users instead of permissions.</p>
<h3 id="setting-permissions">Setting Permissions</h3>
<p>To set a user&rsquo;s permissions to super user in the legacy system, you would call <code>setPermissions</code> on the <code>BUser</code> instance. In the new system, this can be accomplished by adding the &lsquo;admin&rsquo; role to the User.</p>
<p><em>Niagara AX</em></p>
<pre><code>BUser user = new BUser();
user.setPermissions(BPermissionsMap.SUPER_USER);
</code></pre>
<p><em>Niagara 4</em></p>
<pre><code>BUser user = new BUser();
user.addRole(BRoleService.ADMIN_ROLE);
</code></pre>
<h3 id="removing-roles">Removing Roles</h3>
<p>A role can be removed from a user with the <code>removeRole</code> method.</p>
<pre><code>BUser user = new BUser();
user.removeRole(BRoleService.ADMIN_ROLE);
</code></pre>
<h3 id="creating-new-roles">Creating New Roles</h3>
<p>To add a new role to the system create the role, set the permissions and add it to the <code>BRoleService</code>, and set that role onto the user in question.</p>
<pre><code>BIRole buildingOperator = new BRole();
//Building a permissions map is beyond the scope of this article.
BPermissionsMap operatorPermissions = new BPermissionsMap();
buildingOperator.setPermissions(operatorPermissions);
  
//From a workbench context
BIRoleService roleService = (BIRoleService) WbUtil.findService(this, BIRoleService.TYPE);
roleService.add(&quot;buildingOperator&quot;, buildingOperator);
  
BUser bob = new BUser();
bob.addRole(&quot;buildingOperator&quot;);
</code></pre>
<h3 id="modifying-roles">Modifying Roles</h3>
<p>Modifying the permissions of all the building operators can now accomplished by modifying the permissions on one role.</p>
<pre><code>BIRoleService roleService = (BIRoleService) WbUtil.findService(this, BIRoleService.TYPE);
BIRole role = roleService.get(&quot;buildingOperator&quot;);
  
//Clear all the permissions:
role.setPermissions(BPermissionsMap.DEFAULT);
  
//Grant the role super user permissions
role.setPermissions(BPermissionsMap.SUPER_USER);
</code></pre>
<h3 id="disabling-roles">Disabling Roles</h3>
<p>During a maintenance event you can disable or enable certain roles as needed.</p>
<pre><code>//If there is a technical support issue that needs to be investigated:
BIRole role = (BIRole) roleService.get(&quot;techSupport&quot;);
role.setEnabled(true);
...
//after the problem has been resolved
role.setEnabled(false);
</code></pre>
<p>This functionality should help discourage account sharing by allowing permissions to be defined once for each class of user.</p>

<script type='text/javascript'>window.niagara.docDevUtil.highlightCode();</script>

<!-- Auto-generated Footer NavBar --><p class="navbar">  <a href="/doc/index.html" class="navbar">Index</a> |  <a href="/doc/security/authentication.html" class="navbar">Prev</a> |  <a href="/doc/security/headerAuthentication.html" class="navbar">Next</a></p>
<!-- Auto-generated copyright note --><p class='copyright'></p>
</body>
</html>
