<!-- Htmldoc has been run -->
<!--
   @author    Brian Frank
   @creation  2 Oct 01
   @version   $Revision$ $Date$
   @since     Niagara 3.0
 -->

<html>

<head>
<title>Execution</title>
<!-- Auto-generated style sheet link --><link rel='StyleSheet' href='module://bajaui/doc/style.css' type='text/css' />
<!-- Auto-generated js link for Activity Monitoring --><script type='text/javascript' src='module://web/rc/util/activityMonitor.js'></script>
<script type='text/javascript'>window.addEventListener('load', activityMonitor.start);</script>
</head>

<body>
<!-- Auto-generated Header NavBar --><p class="navbar">  <a href="/doc/index.html" class="navbar">Index</a> |  <a href="/doc/links.html" class="navbar">Prev</a> |  <a href="/doc/station.html" class="navbar">Next</a></p>


<!-- Title Block -->
<h1 class='title'>Execution</h1>

<!------------------------------------------------------------->
<h1>Overview</h1>
<!------------------------------------------------------------->

<p>
It is important to understand how <code>BComponents</code> are
executed so that your components play nicely in the Niagara
Framework.  The Niagara execution model is based upon:
</p>

<ul>
<li><b>Running State</b>: Every component may be started or stopped.</li>
<li><b>Links</b>: Links allow events to propagate between components.</li>
<li><b>Timers</b>:  Timers are established using the <code>Clock</code> class.</li>
<li><b>Async Actions</b>:  Async actions are an important feature which prevent
  tight feedback loops.</li>
</ul>

<!------------------------------------------------------------->
<h1>Running State</h1>
<!------------------------------------------------------------->

<p>
Every <code>BComponent</code> maintains a <i>running</i> state
which may be checked via the <code>BComponent.isRunning()</code>
method.  A component may be put into the running state via the
<code>BComponent.start()</code> method and taken out of the
running state via the <code>BComponent.stop()</code> method.
</p>

<p>
By default whenever a <code>BComponent</code> is started, all of
its descendent components are also started recursively.  This
behavior may be suppressed using the <code>Flags.NO_RUN</code>
flag on a property.  During startup, any properties encountered
with the <i>noRun</i> flag set will not be recursed.
</p>

<p>
Every <code>BComponent</code> may add its component specific
startup and shutdown behavior by overriding the <code>started()</code>
and <code>stopped()</code> methods.  These methods should be kept
short; any lengthy tasks should be spawned off on another thread.
</p>

<p class='note'>
Note: Developers will rarely call <code>start()</code> and
<code>stop()</code> themselves.  Rather these methods are
automatically called during station bootup and shutdown.  See
<a href='station.html#bootstrap'>Station Bootstrap</a>.
</p>

<!------------------------------------------------------------->
<h1>Links</h1>
<!------------------------------------------------------------->

<p>
The primary mechanism for execution flow is via the link mechanism.
Links provide a powerful tool for configuring execution flow at
deployment time using Niagara's graphical programming tools.  Developers
should design their components so that hooks are exposed via property,
action, and topic slots.
</p>

<p>
One of the requirements for link propagation is normalized types.
Therefore Niagara establishes some standard types which should
be used to provide normalized data.  Any <i>control point</i> data
should use one of the standard types found in the
<code><a href='module://docDeveloper/doc/baja-rt/javax/baja/status/package-index.bajadoc'>javax.baja.status</a></code>
package.
</p>

<!------------------------------------------------------------->
<h1>Timers</h1>
<!------------------------------------------------------------->

<p>
Niagara provides a standard timer framework which should be used by
components  to setup periodic and one-shot timers.  Timers are created using
the <code>schedule()</code> and <code>schedulePeriodically()</code>methods on
<code><a href='module://docDeveloper/doc/baja-rt/javax/baja/sys/Clock.bajadoc'>Clock</a></code>.
Timer callbacks are an action slot.  The <code>BComponent</code> must
be mounted and running in order to create a timer.
</p>

<p>
There are four types of timers created with four different methods
on Clock.  Two are one-shot timers and two are periodic timers.  The
difference between the two one-shots and periodic timers is based on
how the timers drift.  Refer to the Clock bajadoc for more information.
</p>

<!------------------------------------------------------------->
<h1>Async Actions</h1>
<!------------------------------------------------------------->

<p>
The Niagara execution model is <i>event based</i>.  What this means
is that events are chained through link propagation.  This model
allows the possibility of <i>feedback loops</i> when a event will
loop forever in a cyclical link chain.  To prevent feedback loops,
component which might be configured with cyclical links should use
<i>async actions</i>.  An async action is an action slot with the
<code>Flags.ASYNC</code> flag set.
</p>

<p>Normal actions are invoked immediately either through a direct
invocation or a link propagation.  This invocation occurs on the
callers thread synchronously.  On the other hand, async actions are
designed to run asynchronously on another thread and immediately
return control to the callers thread.  Typically async actions will
coalesce multiple pending invocations.
</p>

<p>
By default async actions are scheduled by the built in engine manager.
The engine manager automatically coalesces action invocations, and
schedules them to be run in the near future (100s of ms).  Thus between
actual execution times if the action is invoked one or one hundred times,
it is only executed once every execution cycle.  This makes it a very
efficient way to handle <i>event blasts</i> such as dozens of property
changes at one time.  However all timer callbacks and async actions in
the VM share the same engine manager thread, so developers should be
cautious not to consume this thread except for short periods.
</p>

<p>
Niagara also provides a hook so that async actions may be scheduled
by subclasses by overriding the <code>post()</code> method.  Using
this method subclasses may schedule the action using their own queues
and threads.  A standard library for managing invocations, queues, and
threads is provided by the following utility classes:
</p>

<ul>
<li><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/util/Invocation.bajadoc'>Invocation</a></code></li>
<li><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/util/Queue.bajadoc'>Queue</a></code></li>
<li><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/util/CoalesceQueue.bajadoc'>CoalesceQueue</a></code></li>
<li><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/util/Worker.bajadoc'>Worker</a></code></li>
<li><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/util/ThreadPoolWorker.bajadoc'>ThreadPoolWorker</a></code></li>
<li><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/util/BWorker.bajadoc'>BWorker</a></code></li>
<li><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/util/BThreadPoolWorker.bajadoc'>BThreadPoolWorker</a></code></li>
</ul>

<!------------------------------------------------------------->
<h1>System Clock Changes</h1>
<!------------------------------------------------------------->

<p>
Some control algorithms are based on absolute time, for
example a routine that runs every minute at the top of the minute.
These algorithms should ensure that they operate correctly even after
system clock changes using the callback
<code>BComponent.clockChanged(BRelTime shift)</code>.
</p>


<!-- Auto-generated Footer NavBar --><p class="navbar">  <a href="/doc/index.html" class="navbar">Index</a> |  <a href="/doc/links.html" class="navbar">Prev</a> |  <a href="/doc/station.html" class="navbar">Next</a></p>
<!-- Auto-generated copyright note --><p class='copyright'></p>
</body>
</html>
