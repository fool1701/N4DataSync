<!-- Htmldoc has been run -->
<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<link rel='stylesheet' href='module://docDeveloper/rc/sunlight.default.css'>
<!-- Auto-generated style sheet link --><link rel='StyleSheet' href='module://bajaui/doc/style.css' type='text/css' />
<!-- Auto-generated js link for Activity Monitoring --><script type='text/javascript' src='module://web/rc/util/activityMonitor.js'></script>
<script type='text/javascript'>window.addEventListener('load', activityMonitor.start);</script>
</head>
<body>
<!-- Auto-generated Header NavBar --><p class="navbar">  <a href="/doc/index.html" class="navbar">Index</a> |  <a href="/doc/report.html" class="navbar">Prev</a> |  <a href="/doc/bql.html" class="navbar">Next</a></p>

<script type='text/javascript' src='module://docDeveloper/rc/sunlight-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.java-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.javascript-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.xml-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.css-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/niagara-sunlight-support.js'></script>

<h1 id="hierarchy">Hierarchy</h1>
<h2 id="overview">Overview</h2>
<p>Refer to the <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/package-index.bajadoc">javax.baja.hierarchy</a> API.</p>
<p>Hierarchies provide a dynamic navigation layer to the Niagara Framework.  By using neql to query tags and relations, they allow for the creation navigation trees that are not based on the station&rsquo;s config.bog tree structure.</p>
<h2 id="creation">Creation</h2>
<p>Hierarchies are defined under the <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BHierarchyService.bajadoc">BHierarchyService</a> and the resulting hierarchy is shown in the <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BHierarchySpace.bajadoc">BHierarchySpace</a>.</p>
<p>The <code>HierarchyService</code> contains the definitions for each hierarchy in the system.  These are the sets of rules for creating navigational hierarchies.  Each hierarchy is defined by a <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BHierarchy.bajadoc">BHierarchy</a> and one or more <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BLevelDef.bajadoc">BLevelDef</a>s.  The ordering of the <code>BLevelDef</code>s under a <code>BHierarchy</code> define the order in which they&rsquo;re used to create the hierarchy.  Each <code>BLevelDef</code> defines a level of a hierarchy where each node at that level uses the same rules for creation and determining its children.</p>
<h3 id="leveldefs">LevelDefs</h3>
<p>The Niagara Framework provides four <code>BLevelDef</code>s for creating hierarchies.  These are divided into two basic types: grouping and entity. The two grouping definitions, <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BListLevelDef.bajadoc">BListLevelDef</a> and <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BGroupLevelDef.bajadoc">BGroupLevelDef</a> implement the <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BIGroupingLevelDef.bajadoc">BIGroupingLevelDef</a> marker interface.  These create virtual groups or folders of entities in the navigational hierarchy.  They are not typically used for leafs in the tree so they will not typically be the last <code>BLevelDef</code> under a <code>BHierarchy</code>.</p>
<p><code>BGroupLevelDef</code> uses <a href="module://docDeveloper/doc/baja-rt/javax/baja/tag/Tag.bajadoc">Tag</a> values to create groupings in a hierarchy.  For each unique value of the given <code>BGroupLevelDef.groupBy</code> <code>Tag</code> in the system, a node will be created in the hierarchy. It is important to note that <code>BGroupLevelDef.groupBy</code> is a single <code>Tag.id</code> and not a neql query.</p>
<p><code>BListLevelDef</code> also creates groupings in a hierarchy.  Unlike <code>BGroupLevelDef</code> where the groupings are dynamic, <code>BListLevelDef</code> creates a static list of groups using <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BNamedGroupDef.bajadoc">BNamedGroupDef</a>s. Each <code>BNamedGroupDef</code> creates a node in the resulting hierarchy and filters the entities under it based on the the defined query.</p>
<p>The two entity level definitions, <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BQueryLevelDef.bajadoc">BQueryLevelDef</a> and  <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BRelationLevelDef.bajadoc">BRelationLevelDef</a>, populate the hierarchy with entity nodes.  Typically these are <a href="module://docDeveloper/doc/baja-rt/javax/baja/sys/BComponent.bajadoc">BComponent</a>s. <code>BQueryLevelDef</code> uses a neql query to determine which entities to display in the hierarchy.  By default, the results are filtered against any preceding <code>BIGroupingLevelDef</code>s in the hierarchy definition.  If this is not desired, the <code>includeGroupingQueries</code> property can be set to <code>false</code>.</p>
<p><code>BRelationLevelDef</code> uses <a href="module://docDeveloper/doc/baja-rt/javax/baja/tag/Relation.bajadoc">Relation</a> traversal to determine the displayed entities.  Starting from the previous entity in the hierarchy, the relations specified by the <code>relationId</code> are traversed and the entities at the <code>endpoints</code> of those <code>Relation</code>s are displayed in the hierarchy.  Given this, a <code>BRelationLevelDef</code> will always be preceded by a <code>BQueryLevelDef</code> in the <code>BHierarchy</code> in order to define the <a href="module://docDeveloper/doc/baja-rt/javax/baja/tag/Entity.bajadoc">Entity</a> being traversed from. By default, inbound relations with the given <code>relationId</code> are followed.  Outbound relations can be used instead by setting <code>inbound</code> to <code>false</code>.  The set of returned entities can be further filtered by setting a neql expression in the <code>filterExpression</code> property.  If <code>repeatRelation</code> is <code>true</code>, additional levels will be created in the hierarchy each time that defined relation is able to be traversed from the endpoint of the previous relation - a typical use of this is to traverse <code>n:child</code> relations to the end of the component tree.</p>
<p>Several properties are common to all <code>BLevelDef</code>s.  The use of the <code>queryContext</code> property is discussed in the Doc Hierarchies Guide. <code>sort</code>, a <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BLevelSort.bajadoc">BLevelSort</a>, can be set to either <code>BLevelSort.ascending</code> or <code>BLevelSort.descending</code>.  <code>hierarchyTags</code> are currently reserved for future use.</p>
<p>A useful tool when working with hierarchies is to turn on logging.  Setting the <code>hierarchy</code> log to <code>FINE</code> under the <code>DebugService</code> will log the neql query that is run to produce each level of a hierarchy when that level is expanded under the <code>HierarchySpace</code>.</p>
<h3 id="scope">Scope</h3>
<p>Hierarchies have a scope.  What this means is that the queries used to produce a hierarchy can be run against one or more <a href="module://docDeveloper/doc/baja-rt/javax/baja/space/BSpace.bajadoc">BSpace</a>s. As of Niagara 4.0, the only supported space is the Station space.  To add additional spaces in the future, one or more <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BHierarchyScope.bajadoc">BHierarchyScope</a>s can be added to the <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BHierarchyScopeContainer.bajadoc">BHierarchyScopeContainer</a> in the <code>BHierarchy</code>.  The <code>scopeOrd</code> is simply the <a href="module://docDeveloper/doc/baja-rt/javax/baja/naming/BOrdScheme.bajadoc">BOrdScheme</a> for the desired space.</p>
<h3 id="roles">Roles</h3>
<p>In order for users to be able to view a hierarchy, they need permissions to do so. When the <code>BHierarchyService</code> is added to a station, the <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BRoleHierarchies.bajadoc">BRoleHierarchies</a> <a href="module://docDeveloper/doc/baja-rt/javax/baja/sys/BIMixIn.bajadoc">BIMixIn</a> is added to each <a href="module://docDeveloper/doc/baja-rt/javax/baja/role/BRole.bajadoc">BRole</a> as the <code>viewableHierarchies</code> property.  <code>BRoleHierarchies.hierarchyNames</code> is a comma separated list of the <code>BHierarchyDef</code> names that the <code>BRole</code> has permissions to view.</p>
<h2 id="navigation">Navigation</h2>
<p>Hierarchies are displayed under the <code>HierarchySpace</code>.  Each <code>BHierarchyDef</code> results in a child of the <code>BHierarchySpace</code>. These children of the Hierarchy Space, and the their children, are <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BLevelElem.bajadoc">BLevelElem</a>s. <code>BLevelElem</code>s implement <a href="module://docDeveloper/doc/baja-rt/javax/baja/nav/BINavNode.bajadoc">BINavNode</a> and are traversed using <code>BINavNode.getNavChildren()</code> and <code>BINavNode.getNavParent()</code>.</p>
<h3 id="ords">Ords</h3>
<p>The <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/BHierarchyOrdScheme.bajadoc">HierarchyOrdScheme</a> defines <code>hierarchy:</code> as the <a href="module://docDeveloper/doc/baja-rt/javax/baja/naming/BOrdScheme.bajadoc">BOrdScheme</a> for resolving <code>BLevelElem</code>s in a hierarchy.  A <a href="module://docDeveloper/doc/hierarchy-rt/javax/baja/hierarchy/HierarchyQuery.bajadoc">HierarchyQuery</a> is used for the body of the <a href="module://docDeveloper/doc/baja-rt/javax/baja/naming/BOrd.bajadoc">BOrd</a>.</p>
<p>Note that since each part of a <code>HierarchyQuery</code> may result in a neql query being executed, hierarchy: Ord resolution may be very expensive. If hierarchy: Ords need to be resolved, developers should consider caching the results for improved performance.</p>
<h2 id="code-samples">Code Samples</h2>
<p>The following code samples assume that you have hierarchies defined with given names and are provided as a getting started point.</p>
<h3 id="resolve-a-hierarchy-ord-in-the-client">Resolve a hierarchy: Ord in the Client</h3>
<pre><code class="sunlight-highlight-java">  BHierarchySpace hierarchySpace = (BHierarchySpace)BOrd.make(&quot;hierarchy:&quot;).get(rootComponent);  
  BLevelElem sampleHierarchy = (BLevelElem)BOrd.make(&quot;hierarchy:SampleHierarchy&quot;).get(rootComponent);  
</code></pre>
<h3 id="resolve-a-hierarchy-ord-in-the-station">Resolve a hierarchy: Ord in the Station</h3>
<p>Even though hierarchy definitions exist in the station, the resulting hierarchies only exist in the client environment. Given this, Ord resolutions will only work in the client environment. To resolve hierarchy: Ord in the station, we need to use an alternative method. <code>BHierarchyService.resolveHierarchyLevelElem()</code> allows us to resolve HierarchiesQueries in the station VM.</p>
<pre><code class="sunlight-highlight-java">  BHierarchyService hierarchyService = (BHierarchyService)BOrd.make(&quot;service:hierarchy:HierarchyService&quot;).get(rootComponent);  
  BLevelElem sampleHierarchy = hierarchyService.resolveHierarchyLevelElem(new HierarchyQuery(&quot;/sampleHierarchy&quot;));  
</code></pre>
<h3 id="hierarchy-traversal">Hierarchy Traversal</h3>
<p>Hierarchy traversal is best accomplished by treating <code>BLevelElem</code>s as <code>BINavNode</code>s.</p>
<pre><code class="sunlight-highlight-java">  BLevelElem sampleHierarchy = (BLevelElem)BOrd.make(&quot;hierarchy:SampleHierarchy&quot;).get(rootComponent);  
  BINavNode[] firstLevelChildren = sampleHierarchy.getNavChildren();  
  for (int i=0; i&lt;firstLevelChildren.length; i++)  
  {  
    System.out.println(firstLevelChildren[i].getNavDisplayName(null));  
  }  
</code></pre>

<script type='text/javascript'>window.niagara.docDevUtil.highlightCode();</script>

<!-- Auto-generated Footer NavBar --><p class="navbar">  <a href="/doc/index.html" class="navbar">Index</a> |  <a href="/doc/report.html" class="navbar">Prev</a> |  <a href="/doc/bql.html" class="navbar">Next</a></p>
<!-- Auto-generated copyright note --><p class='copyright'></p>
</body>
</html>
