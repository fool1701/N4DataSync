<!--
   @author    Kevin McIntire
   @creation  10 Oct 01
   @version   $Revision$ $Date$
   @since     Niagara 3.0
 -->

<html>

<head>
<title>Slot-o-matic</title>
<link rel='stylesheet' href='module://docDeveloper/rc/sunlight.default.css'>
</head>

<body>

<script type='text/javascript' src='module://docDeveloper/rc/sunlight-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.java-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/niagara-sunlight-support.js'></script>

<!-- Title Block -->
<h1 class='title'>Slot-o-matic</h1>

<!------------------------------------------------------------->
<h1>Overview</h1>
<!------------------------------------------------------------->
  <p>
    The <b>Slot-o-matic</b> is a java source code
    preprocessor which generates java source code for
    Baja slots based on a predefined comment header block.
    The generated code is placed in the same source file,
    and all other code in the original source is not modified
    in any way.
  </p>

<!------------------------------------------------------------->
<h1>Usage</h1>
<!------------------------------------------------------------->
  <h2>Invocation</h2>
    <p>
      Slot-o-matic is invoked by the executable <code>slot.exe
      </code>.  To get help invoke:
    </p>
    <pre>
D:\&gt;slot -?

usage: slot [-f] [-?] &lt;dir | file ...&gt;
-f force recompile of specified targets
-? provides additional help.

slot compiles Baja object files.

For a file to be compiled, it must have a name
  of the form B[A-Z]*.java.

slot will happily recurse any and all directory arguments.
    </pre>
    <p>
      Slot-o-matic will compile any file that meets the
      following conditions:
    </p>
    <p>
      <ol>
        <li>The file name is of format <i>B[A-Z]*.java</i>, e.g.
            <i>BObject.java</i> or <i>BSystem.java</i>,
            but not <i>Ball.java.</i></li>
          <li>The source code has a comment block delimited
              by <code>/*- -*/</code>.</li>
      </ol>
    </p>
    <p>
      When Slot-o-matic compiles a file, it reads the comment
      block and generates new java source code based on the
      contents of that block.  The new source is placed in the
      file being compiled immediately <b>after</b> the Baja comment
      block.  If any errors are found, the contents of the file
      are not altered in any way.  The source file may (and indeed
      probably must) have any other source code required to
      implement the class in the source file, as with normal java
      source.  The <b>only</b> difference between a normal java
      source file and one usable by Slot-o-matic is the <code>
      /*- -*/</code> comment block.
    </p>
    <p>
      Compiling a file is simple:
    </p>
    <pre>
D:\>slot D:\niagara\r3dev\fw\history\javax\baja\history\BHistoryService.java
  Compile BHistoryService.java
Compiled 1 files

D:\>
    </pre>
    <p>
      As is a directory:
    </p>
    <pre>
D:\>slot D:\niagara\r3dev\fw\history
  Compile BHistoryService.java
Compiled 1 files

D:\>
    </pre>
    <p>
      Slot-o-matic works like <code>make</code> in that it
      will only compile files whose /*- -*/ comment block's
      content has changed since the last compile.  To force
      recompile, use the <code>-f</code> flag on a file or
      directory:
    </p>
    <pre>
D:\&gt;slot -f D:\niagara\r3dev\fw\history\src\javax\baja\history\
  Compile BBooleanHistory.java
  Compile BFloatHistory.java
  Compile BHistory.java
  Compile BHistoryDevicelet.java
  Compile BHistoryJoin.java
  Compile BHistoryPeriod.java
  Compile BHistoryService.java
  Compile BHistorySync.java
  Compile BStorageType.java
Compiled 9 files

D:\&gt;
    </pre>

  <!------------------------------------------------------------->
  <h2>Slot file format</h2>
  <!------------------------------------------------------------->
  <p>
    As stated above, Slot-o-matic will compile only files that
    meet certain conditions.  In addition to having an appropriate
    file (and by extension class) name, the source code in the file
    must contain a comment block that describes the slots on the object
    to be compiled.
  </p>
  <!------------------------------------------------------------->
  <h3>Examples</h3>
  <!------------------------------------------------------------->
    <h4>Class Example</h4>
      <p>
        This example class would resolve in a file named
        <i>BImaginaryObject.java</i>.
      </p>
    <pre>
      <code class="sunlight-highlight-java">
  /*-
  class BImaginaryObject
  {
    properties
    {
      imaginaryName: String
        -- The imaginary name for the imaginary object.
        default {[ "imaginaryName" ]}
      size: int
        -- The size of the imaginary object.
        flags { readonly, transient }
        default {[ 0 ]}
    }
    actions
    {
      imagine(arg: BComponent)
        -- Imagine something
        default {[ new BComponent() ]}
      create(): BSystem
        -- Create a new imaginary system.
    }
    topics
    {
      imaginationLost: BImaginaryEvent
        -- Fire an event when the object loses its imagination.
    }
  }
  -*/
        </code>
      </pre>
      <p>
        There are blocks for each of the major slot types: properties,
        actions, and topics.  None of the blocks needs to be present.
      </p>
      <h5>Properties Block</h5>
        <p>
          Each property has a name and a data type.  Comments are
          specified via the "--" tag per line of comment.  All comments
          are transferred to the javadoc headers of the generated source
          code but are of course optional.  A default value for all
          properties <b>must</b> be specified.  The default block is
          delineated by <code>{[ ]}</code> and may have any sequence of java
          code inside it.  Flags on the property may also optionally be
          specified.  For more information on the available flags, see
          the <a href='module://docDeveloper/doc/baja-rt/javax/baja/sys/Flags.bajadoc'>
          Flags bajadoc</a>.  Slot-o-matic will generate all <code>get</code>
          and <code>set</code> methods for the property.
        </p>
      <h5>Actions Block</h5>
        <p>
          Each action may have 0 or 1 input (formal) arguments,
          and may optionally return a value.  Actions are commented
          like properties.  The input argument, if present, <b>must</b>
          have a default value as with a property.  Slot-o-matic will
          generate the action invocation code; the implementor of the
          class must provide a do&lt;actionName&gt; method that
          provides the action implementation.
        </p>
      <h5>Topics Block</h5>
        <p>
          Each topic specifies a name and an event type that it sends
          when fired.  Slot-o-matic generates code to fire the event.
        </p>
    <h4>Enum Example</h4>
      <p>
        This example class would resolve in a file named
        <i>BImaginaryEnum.java</i>.
      </p>
      <pre>
        <code class="sunlight-highlight-java">
  /*-

  enum BImaginaryEnum
  {
    range
    {
      good,
      bad,
      ugly
    }

    default {[ bad ]}
  }

  -*/
        </code>
      </pre>
      <p>
        Each member of the enumeration is specified.
      </p>

  <h3>BNF</h3>
  <p>
    The formal BNF of the format is as follows:
  </p>

<TABLE>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Unit</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( Annotation )? ( Class | Enum )</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Class</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"class" Identifier "{" ( Singleton )? ( PropertyBlock | ActionBlock | TopicBlock )* "}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Singleton</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"singleton"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>PropertyBlock</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( Annotation )* "properties" "{" ( Property )* "}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Property</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( Annotation )* Identifier ":" BajaType ( Default | Flags | SlotFacets )*</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>ActionBlock</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( Annotation )* "actions" "{" ( Action )* "}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Action</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( Annotation )* Identifier "(" ( FormalParameter )? ")" ( ":" BajaType )? ( Default | Flags | SlotFacets )*</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>FormalParameter</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>Identifier ( ":" BajaType )?</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>TopicBlock</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( Annotation )* "topics" "{" ( Topic )* "}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Topic</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( Annotation )* Identifier ( ":" BajaType )? ( Flags | SlotFacets )*</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Enum</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"enum" Identifier "{" RangeBlock EnumDefault"}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>RangeBlock</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"range" "{" ( Range ( "," Range )* )? ( "," )? "}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Range</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>Identifier ( "=" JavaExpression )?</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>EnumDefault</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"default" "{" "[" JavaExpression "]" "}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Flags</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"flags" "{" ( Identifier ( "," Identifier )* )? ( "," )? "}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Default</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"default" "{" "[" JavaExpression "]" "}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>SlotFacets</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"slotfacets" "{" "[" ( Facets ( "," Facets )* )? ( "," )? "]" "}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Facets</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( BajaName "=" )? JavaExpression</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Identifier</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;IDENTIFIER&gt;</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>BajaType</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( BajaPrimitive | BajaName )</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>BajaPrimitive</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( "boolean" | "int" | "long" | "float" | "double" )</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>BajaName</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>Identifier ( "." Identifier )*</TD>
</TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>Annotation</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"@" Identifier ( NormalAnnotation | SingleAnnotation )?</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>SingleAnnotation</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"(" ( JavaExpression | JavaExpressionList ) ")"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>NormalAnnotation</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"(" KeyValue ( "," KeyValue )* ")"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>KeyValue</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>Identifier "=" ( JavaExpression | JavaExpressionList )</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>JavaExpressionList</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>"{" JavaExpression ( "," JavaExpression )* ( "," )? "}"</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE>JavaExpression</TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;JAVA_EXPRESSION&gt;</TD>
</TR>
</TABLE>

<script type="text/javascript">
    window.niagara.docDevUtil.highlightCode();
</script>
</body>
</html>
