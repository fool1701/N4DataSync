<!-- Htmldoc has been run -->
<!--
   @author    {stubbed out by Brian}
   @creation  9 Jul 03
   @version   $Revision$ $Date$
   @since     Niagara 3.0
 -->

<html>

<head>
<title>Registry</title>
<link rel='stylesheet' href='module://docDeveloper/rc/sunlight.default.css'>
<!-- Auto-generated style sheet link --><link rel='StyleSheet' href='module://bajaui/doc/style.css' type='text/css' />
<!-- Auto-generated js link for Activity Monitoring --><script type='text/javascript' src='module://web/rc/util/activityMonitor.js'></script>
<script type='text/javascript'>window.addEventListener('load', activityMonitor.start);</script>
</head>

<body>
<!-- Auto-generated Header NavBar --><p class="navbar">  <a href="/doc/index.html" class="navbar">Index</a> |  <a href="/doc/buildingComplexes.html" class="navbar">Prev</a> |  <a href="/doc/collections.html" class="navbar">Next</a></p>


<script type='text/javascript' src='module://docDeveloper/rc/sunlight-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.java-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/sunlight.xml-min.js'></script>
<script type='text/javascript' src='module://docDeveloper/rc/niagara-sunlight-support.js'></script>

<!-- Title Block -->
<h1 class='title'>Registry</h1>

<!------------------------------------------------------------->
<h1>Overview</h1>
<!------------------------------------------------------------->

<p>
The registry is a term for a small database built by the Niagara
runtime whenever it detects that a module has been added, changed,
or removed.  During the registry build process all the types in
all the modules are scanned.  Their classfiles are parsed to build
an index for the class hierarchy of all the Niagara types available
in the installation.
</p>

<p>
Some of the functions the registry provides:
</p>

<ul>

<li>query modules installed without opening each jar file</li>
<li>query class hierarchy without loading actual Java classes</li>
<li>query agents registered on a given Type</li>
<li>map file extensions to their <code>BIFile</code> Types</li>
<li>map ord schemes to their <code>BOrdScheme</code> Types</li>
<li>defs provide a global map of name/value pairs</li>
<li>query lexicons registered on a given module</li>

</ul>

<!------------------------------------------------------------->
<h1 id="api">API</h1>
<!------------------------------------------------------------->

<p>
The <code><a href='module://docDeveloper/doc/baja-rt/javax/baja/registry/Registry.bajadoc'>Registry</a></code>
database may be accessed via <code>Sys.getRegistry()</code>.  Since
the primary use of the registry is to interrogate the system about modules
and types without loading them into memory, the registry API uses light
weight wrappers:
</p>

<table border='1'>
<tr><th>Registry Wrapper</th><th>Real McCoy</th></tr>
<tr>
<td><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/registry/ModuleInfo.bajadoc'>ModuleInfo</a></code></td>
<td><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/sys/BModule.bajadoc'>BModule</a></code></td>
</tr><tr>
<td><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/registry/TypeInfo.bajadoc'>TypeInfo</a></code></td>
<td><code><a href='module://docDeveloper/doc/baja-rt/javax/baja/sys/Type.bajadoc'>Type</a></code></td>
</tr></table>

<!------------------------------------------------------------->
<h1 id="agents">Agents</h1>
<!------------------------------------------------------------->

<p>
An agent is a special BObject type that provides services for
other BObject types.  Agents are registered on their target
types via the module manifest and queried via the Registry
interface.  Agents are used extensively in the framework for
late binding - such as defining views, popup menus, or exporters
for specified target types.  Typically agent queries are combined
with a type filter.  For example, to find all the BExporters
registered on a given file:
</p>

<pre>
  <code class="sunlight-highlight-java">
  AgentFilter filter = AgentFilter.is(BExporter.TYPE);
  AgentList exporters = file.getAgents(null).filter(filter);
  </code>
</pre>

A couple of examples of how an agent type is registered on a target type
in the module manifest (module-include.xml):

<pre>
  <code class="sunlight-highlight-xml">
  &lt;type name="ValueBinding" class="javax.baja.ui.BValueBinding"&gt;
    &lt;agent&gt;&lt;on type="bajaui:Widget"/&gt;&lt;/agent&gt;
    &lt;agent&gt;&lt;on type="baja:Value"/&gt;&lt;/agent&gt;
  &lt;/type&gt;

  &lt;type name="PropertySheet" class="com.tridium.workbench.propsheet.BPropertySheet"&gt;
    &lt;agent requiredPermissions="r"&gt;&lt;on type="baja:Component"/&gt;&lt;/agent&gt;
  &lt;/type&gt;
  </code>
</pre>

<p>
Agents can be registered on a target only for a specific application
using the <code>app</code> attribute within the <code>agent</code>
tag.  The application name can be queried at runtime via the
<code>AgentInfo.getAppName()</code> method.  Agent application names
are used in conjunction with the <code>getAppName()</code> method of
<code><a href='module://docDeveloper/doc/workbench-wb/javax/baja/workbench/BWbProfile.bajadoc'>BWbProfile</a></code> and
<code><a href='module://docDeveloper/doc/hx-wb/javax/baja/hx/BHxProfile.bajadoc'>BHxProfile</a></code>.
An example application specific agent:

<pre>
  <code class="sunlight-highlight-xml">
  &lt;type name="ApplianceUserManager"  class="appliance.ui.BApplianceUserManager"&gt;
    &lt;agent app="demoAppliance"&gt;
      &lt;on type="baja:UserService"/&gt;
    &lt;/agent&gt;
  &lt;/type&gt;
  </code>
</pre>


<!------------------------------------------------------------->
<h1 id="defs">Defs</h1>
<!------------------------------------------------------------->

<p>
Modules can declare zero or more defs in their module manifest.  Defs
are simple String name/value pairs that are collapsed into a single
global map by the registry.  A good use of defs is to map a device id
to a typespec, bog file, or some other metadata file.  Then the registry
may be used to map devices to Niagara information at learn time.
</p>

<p>
Since the defs of all modules are collapsed into a single map, it is
important to avoid name collisions.  Convention is to prefix your
defs using module name plus a dot, for example "lonworks."
</p>

<p>
When using Niagara's standard build tools, defs are defined in
your "module-include.xml":
</p>

<pre>
  <code class="sunlight-highlight-xml">
&lt;defs&gt;
  &lt;def name="test.a" value="alpha"/&gt;
  &lt;def name="test.b" value="beta"/&gt;
&lt;/defs&gt;
  </code>
</pre>

<p>
Use the registry API to query for defs:
</p>

<pre>
  <code class="sunlight-highlight-java">
  String val = Sys.getRegistry().getDef("test.a");
  </code>
</pre>

<!------------------------------------------------------------->
<h1>Spy</h1>
<!------------------------------------------------------------->

<p>
A good way to learn about the registry is to navigate its <a href='local:|spy:/sysManagers/registryManager'>spy pages</a>.

<script type="text/javascript">
    window.niagara.docDevUtil.highlightCode();
</script>

<!-- Auto-generated Footer NavBar --><p class="navbar">  <a href="/doc/index.html" class="navbar">Index</a> |  <a href="/doc/buildingComplexes.html" class="navbar">Prev</a> |  <a href="/doc/collections.html" class="navbar">Next</a></p>
<!-- Auto-generated copyright note --><p class='copyright'></p>
</body>
</html>
