<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>bajaux Tutorial: Getting Started - MyFirstWidget</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">bajaux</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-bajaux_commands_Command.html">bajaux/commands/Command</a></li><li><a href="module-bajaux_commands_CommandGroup.html">bajaux/commands/CommandGroup</a></li><li><a href="module-bajaux_commands_ToggleCommand.html">bajaux/commands/ToggleCommand</a></li><li><a href="module-bajaux_commands_ToggleCommandGroup.html">bajaux/commands/ToggleCommandGroup</a></li><li><a href="module-bajaux_container_wb_Clipboard.html">bajaux/container/wb/Clipboard</a></li><li><a href="module-bajaux_container_wb_StringList.html">bajaux/container/wb/StringList</a></li><li><a href="module-bajaux_dragdrop_dragDropUtils.html">bajaux/dragdrop/dragDropUtils</a></li><li><a href="module-bajaux_dragdrop_Envelope.html">bajaux/dragdrop/Envelope</a></li><li><a href="module-bajaux_dragdrop_NavNodeEnvelope.html">bajaux/dragdrop/NavNodeEnvelope</a></li><li><a href="module-bajaux_dragdrop_StringEnvelope.html">bajaux/dragdrop/StringEnvelope</a></li><li><a href="module-bajaux_events.html">bajaux/events</a></li><li><a href="module-bajaux_icon_iconUtils.html">bajaux/icon/iconUtils</a></li><li><a href="module-bajaux_lifecycle_WidgetManager.html">bajaux/lifecycle/WidgetManager</a></li><li><a href="module-bajaux_mixin_batchLoadMixin.html">bajaux/mixin/batchLoadMixin</a></li><li><a href="module-bajaux_mixin_batchSaveMixin.html">bajaux/mixin/batchSaveMixin</a></li><li><a href="module-bajaux_mixin_responsiveMixIn.html">bajaux/mixin/responsiveMixIn</a></li><li><a href="module-bajaux_mixin_subscriberMixIn.html">bajaux/mixin/subscriberMixIn</a></li><li><a href="module-bajaux_Properties.html">bajaux/Properties</a></li><li><a href="module-bajaux_registry_Registry.html">bajaux/registry/Registry</a></li><li><a href="module-bajaux_registry_RegistryEntry.html">bajaux/registry/RegistryEntry</a></li><li><a href="module-bajaux_spandrel.html">bajaux/spandrel</a></li><li><a href="module-bajaux_spandrel_jsx.html">bajaux/spandrel/jsx</a></li><li><a href="module-bajaux_util_CommandButton.html">bajaux/util/CommandButton</a></li><li><a href="module-bajaux_util_CommandButtonGroup.html">bajaux/util/CommandButtonGroup</a></li><li><a href="module-bajaux_util_SaveCommand.html">bajaux/util/SaveCommand</a></li><li><a href="module-bajaux_Validators.html">bajaux/Validators</a></li><li><a href="module-bajaux_Widget.html">bajaux/Widget</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="interfaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Interfaces<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-bajaux_commands_Command-Undoable.html">bajaux/commands/Command~Undoable</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-10-mfw-gettingStarted.html">Getting Started - MyFirstWidget</a></li><li><a href="tutorial-20-mfw-modifying.html">Saving Modifications to Station</a></li><li><a href="tutorial-30-mfw-dashboarding.html">Making your Widget Dashboardable</a></li><li><a href="tutorial-40-tipsAndTricks.html">Tips and Tricks</a></li><li><a href="tutorial-50-spandrel.html">Building Composite Widgets With spandrel</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    

    <h2>Getting Started - MyFirstWidget</h2>
</header>

<article>
    <p>In this first tutorial, we're going to create a new Niagara Module with a very simple <code>Widget</code> that will render seamlessly in both Workbench and the browser.</p>
<h2>Outline</h2>
<p>Our new Niagara Module will have the following directory structure. (When creating a <code>bajaux</code> module from scratch, please consider using <a href="module://docDeveloper/doc/js/buildingJS.html#grunt-init-niagara">grunt-init-niagara</a> - it will walk you through creating all the boilerplate files and let you get right to coding.)</p>
<pre class="prettyprint source"><code>+- myFirstModule
   +- myFirstModule-ux
      +- src
      |  +- com
      |  |  +- companyname
      |  |     +- myFirstModule
      |  |        +- ux
      |  |           +- BMyFirstWidget.java
      |  +- rc
      |     +- MyFirstWidget.js
      +- myFirstModule-ux.gradle.kts
</code></pre>
<p>All the code for a bajaux <code>Widget</code> goes into the <code>-ux</code> module subdirectory. (Workbench and Hx Views belong in <code>-wb</code>.)</p>
<ul>
<li><code>BMyFirstWidget.java</code>: a Java class to register our JavaScript with the Niagara Framework.</li>
<li><code>MyFirstWidget.js</code>: the JavaScript bajaux <code>Widget</code>.</li>
<li><code>myFirstModule-ux.gradle.kts</code>: used to build the JAR file.</li>
</ul>
<h2>MyFirstWidget.js</h2>
<p>Let's make our first attempt at implementing a Widget! This will be a very simple Widget that displays the value of a <code>Ramp</code> Component from the <code>kitControl</code> palette.</p>
<pre class="prettyprint source lang-javascript"><code>/**
 * A module defining `MyFirstWidget`.
 * @module nmodule/myFirstModule/rc/MyFirstWidget
 */
define([
  'bajaux/mixin/subscriberMixIn',
  'bajaux/Widget',
  'underscore' ], function (
  subscriberMixIn,
  Widget,
  _) {

  'use strict';

  /**
   * An editor for working with `kitControl:Ramp` instances. 
   *
   * @class
   * @extends module:bajaux/Widget
   * @alias module:nmodule/myFirstModule/rc/MyFirstWidget
   */
  return class MyFirstWidget extends Widget {
    constructor() {
      super(...arguments);
      subscriberMixIn(this);
    }

    /**
     * Describe how your `Widget` does its initial setup of the DOM.
     *
     * @param {JQuery} dom - The DOM element into which to initialize this `Widget`
     */
    doInitialize(dom) {
      const initialValue = 'value goes here';

      // when building HTML directly, remember to perform proper escaping to prevent XSS vulnerabilities.
      // _.escape() is only one of many ways to do this. Calling .text() instead of .html() on a
      // jQuery object is another.
      dom.html(`&#60;input type=&quot;text&quot; value=&quot;${ _.escape(initialValue) }&quot; &#62;`);
    }

    /**
     * Describe how your `Widget` loads in a value.
     *
     * Thanks to `subscriberMixIn`, we can subscribe to changes to the Ramp
     * component to ensure that the DOM is always kept up to date.
     *
     * @param {baja.Component} ramp - an instance of `kitControl:Ramp`.
     */
    doLoad(ramp) {
      const update = () => {
        this.jq().children('input').val(ramp.getOut().getValueDisplay());
      };

      // Call update whenever a Property changes
      this.getSubscriber().attach('changed', update);

      // Call update for the first time.
      update();
    }
  };
});
</code></pre>
<p>Even if you're new to JavaScript, this code shouldn't look too strange to you. It simply loads a Niagara value into a JavaScript <code>Widget</code>.</p>
<ul>
<li>The JavaScript code is wrapped in a <code>define()</code> function. This is how we write <a href="http://requirejs.org/docs/whyamd.html">modular</a> JavaScript code.</li>
<li>The JavaScript defines a new <code>MyFirstWidget</code> constructor that extends from <code>Widget</code>.</li>
<li><code>doInitialize</code> injects some HTML when the <code>Widget</code> is created.
<ul>
<li>The <code>dom</code> object being passed in is a DOM element embedded in a <a href="https://jquery.com/">jQuery</a> wrapper.</li>
</ul>
</li>
<li><code>doLoad</code> updates the HTML when the ramp is passed into the <code>Widget</code>.
<ul>
<li>The value is a subscribed BajaScript proxy Component of the Ramp that sits in the Station. It's already subscribed because the <code>Widget</code> uses a <a href="module-bajaux_mixin_subscriberMixIn.html">subscriberMixIn</a>.</li>
<li>The value will be automatically unsubscribed when the <code>Widget</code> is destroyed.</li>
<li>The <a href="module-bajaux_mixin_subscriberMixIn.html">subscriberMixIn</a> automatically adds the <code>getSubscriber</code> method to the <code>Widget</code>. This is used to attach a listener for <code>changed</code> events.</li>
<li>Every time a property on the Ramp Component changes, the <code>update</code> method will be called to update the user interface. Note that we call it the first time ourselves - otherwise the user wouldn't see any data at all until a <code>changed</code> event came through.</li>
</ul>
</li>
</ul>
<p>This looks like a pretty solid first attempt. But there's a potential problem in this implementation of <code>doLoad()</code>. Can you spot it? Remember: <code>load()</code> can be called multiple times, with different values each time. Take a second look...</p>
<p>...and you may find that the subscriber does not remove any previous event handlers! If you were to unload the current <code>Ramp</code> and load in a new one, like this:</p>
<pre class="prettyprint source lang-javascript"><code>baja.Ord.make('station:|slot:/Ramp1').get()
  .then((ramp1) => myWidget.load(ramp1))
  .then(() => baja.Ord.make('station:|slot:/Ramp2').get())
  .then((ramp2) => myWidget.load(ramp2));
</code></pre>
<p>then when <code>Ramp2</code> fired a <code>changed</code> event, the old event handler would still fire once (with the previous, wrong values) before firing a second time with the new values! Due to the nature of JavaScript closures, every time we load a Ramp, we pass a function with a permanent reference to that Ramp that will be fired whenever the subscriber receives a <code>changed</code> event. Subscriber gets a <code>changed</code> event from <code>Ramp2</code> but it still fires the event handler we loaded from <code>Ramp1</code>!</p>
<p>What can we do?</p>
<p>One option is to keep a reference to the event handler when we add it, and pass it to <code>getSubscriber().detach()</code> before attaching the new handler. This would work, but it would be a bit clunky.</p>
<p>I recommend this approach. (I'll also replace the boilerplate JSDoc from the first example for this final version.)</p>
<pre class="prettyprint source lang-javascript"><code>/**
 * A module defining `MyFirstWidget`.
 * @module nmodule/myFirstModule/rc/MyFirstWidget
 */
define([
  'bajaux/mixin/subscriberMixIn',
  'bajaux/Widget',
  'underscore' ], function (
  subscriberMixIn,
  Widget,
  _) {

  'use strict';

  /**
   * An editor for working with `kitControl:Ramp` instances.
   *
   * @class
   * @extends module:bajaux/Widget
   * @alias module:nmodule/myFirstModule/rc/MyFirstWidget
   */
  return class MyFirstWidget extends Widget {
    constructor() {
      super(...arguments);
      subscriberMixIn(this);
    }

    /**
     * Creates a text input to show the current value and subscribes for future updates.
     * @param {JQuery} dom
     */
    doInitialize(dom) {
      const initialValue = 'value goes here';
      
      dom.html(`&#60;input type=&quot;text&quot; value=&quot;${ _.escape(initialValue) }&quot; &#62;`);
      
      this.getSubscriber().attach('changed', () => this.$updateDom(this.value()));
    }

    /**
     * Shows the Ramp's current value in the DOM.
     * @param {baja.Component} ramp - an instance of `kitControl:Ramp`.
     */
    doLoad(ramp) {
      this.$updateDom(ramp);
    }

    /**
     * @private
     * @param {baja.Component} ramp - an instance of `kitControl:Ramp`.
     */
    $updateDom(ramp) {
      this.jq().children('input').val(ramp.getOut().getValueDisplay());
    }
  }
});
</code></pre>
<p>We've moved the attachment to the <code>changed</code> event from <code>doLoad()</code> to <code>doInitialize()</code>. This works better for a few reasons.</p>
<ul>
<li><code>doInitialize()</code> only runs once, so it's a good place to arm event handlers, such as <code>changed</code>.</li>
<li>The methods are smaller and easier to read.</li>
<li>The code to update the DOM based on the Ramp's current values is well-defined, and has its own<br>
method.</li>
</ul>
<p>When using <a href="module-bajaux_mixin_subscriberMixIn.html">subscriberMixIn</a>, there is only one <code>Subscriber</code> instance that lives for the life of your Widget, and it's always subscribed to the Component that is currently loaded. Therefore, it's safe to arm a <code>changed</code> handler, and it will get fired whenever the currently loaded Component fires a <code>changed</code> event. And <code>this.value()</code> will always return the currently loaded Component!</p>
<p>We've also moved the actual implementation of updating the DOM into a separate, private <code>$updateDom()</code> method. Why didn't we just keep everything in <code>doLoad()</code> and then just call <code>doLoad()</code> directly from our <code>changed</code> event handler? Remember the note about <code>do</code> methods from the introduction: call <code>load()</code>, implement <code>doLoad()</code>; don't implement <code>load()</code>, don't call <code>doLoad()</code>. As a best practice, if you want to reuse the logic of <code>doLoad()</code> (or any <code>do</code> method), don't call it directly; refactor it out to a shared function that <em>can</em> be called directly.</p>
<p>On the last point: for best testability, I recommend that you <em>minimize the amount of code inside event handlers</em>. In a test, it can be complicated to hit all the code branches inside an event handler because you can't call it directly. But we've refactored the actual logic out of the event handler. Now the event handler is just &quot;glue code&quot; - its only purpose is to link the component event to the <code>$updateDom()</code> method. Testing the glue connection is easy (trigger the event and verify <code>$updateDom()</code> got called); and testing the logic itself is easy - just call <code>$updateDom()</code> directly!</p>
<h2>BMyFirstWidget.java</h2>
<pre class="prettyprint source lang-java"><code>package com.companyname.myFirstModule.ux;

import javax.baja.naming.BOrd;
import javax.baja.nre.annotations.AgentOn;
import javax.baja.nre.annotations.NiagaraSingleton;
import javax.baja.nre.annotations.NiagaraType;
import javax.baja.sys.BSingleton;
import javax.baja.sys.Context;
import javax.baja.sys.Sys;
import javax.baja.sys.Type;
import javax.baja.web.BIFormFactorMax;
import javax.baja.web.js.BIJavaScript;
import javax.baja.web.js.JsInfo;

@NiagaraType(agent = @AgentOn(types = &quot;kitControl:Ramp&quot;))
@NiagaraSingleton
public final class BMyFirstWidget extends BSingleton implements BIJavaScript, BIFormFactorMax
{
  private BMyFirstWidget() {}

  public JsInfo getJsInfo(Context cx) { return JS_INFO; }

  private static final JsInfo JS_INFO =
      JsInfo.make(BOrd.make(&quot;module://myFirstModule/rc/MyFirstWidget.js&quot;));
}
</code></pre>
<ul>
<li>The class implements <code>BIJavaScript</code>. This means that the purpose of this Java class is just to register the existence of a JavaScript module with the Niagara Framework. The Java class does not have any behavior of its own.</li>
<li>The <code>JsInfo</code> tells the framework that the JavaScript file that contains the actual implementation is <code>MyFirstWidget.js</code>. In real life, our <code>JsInfo</code> would also reference a <code>BJsBuild</code>. More information about this in the <a href="module://docDeveloper/doc/js/buildingJS.html#whatJavaScriptFileDefinesMyEditor">Building JavaScript Applications</a> help document.</li>
<li>The class implements <code>javax.baja.web.BIFormFactorMax</code>. This tells the framework that it represents a <code>bajaux</code> Widget to be rendered as a fullscreen View in Workbench and the HTML5 Profile. (If we wanted a field editor, we would use <code>BIFormFactorMini</code>.)</li>
<li>The class extends <code>javax.baja.sys.BSingleton</code> so a new instance of it doesn't need to be created each time. Note that it is <code>final</code> so it cannot be extended.</li>
<li>The class is an agent on <code>kitControl:Ramp</code>. This tells the framework that when we navigate to a Ramp instance, it should render a <code>MyFirstWidget</code> to show it to us. Note that it uses the <code>@NiagaraType</code> and <code>@AgentOn</code> annotations, so the agent registration is automatically added for us when we build the module - we no longer have to edit <code>module-include.xml</code> by hand.</li>
</ul>
<h3>myFirstModule-ux.gradle.kts</h3>
<p>Add the following to the gradle file to ensure all relevant files are included in the built module. This snippet includes every file in the <code>rc/</code> directory, which is appropriate for most use cases, but you can change it to be more selective if needed.</p>
<pre class="prettyprint source"><code>tasks.named&lt;Jar>(&quot;jar&quot;) {
  from(&quot;src&quot;) {
    include(&quot;rc/&quot;)
  }
}
</code></pre>
<h2>Results</h2>
<p>Building this module will result in the Ramp Component having a new pure HTML5 View available in Workbench, Hx, and the HTML5 Profile.</p>
<ul>
<li>The same code is used in both Workbench and browser environments.</li>
<li>As it's a View, it can be accessed directly or added to a Px page.</li>
<li>The code for the <code>Widget</code> is embedded in a distributable JAR file.</li>
</ul>
<h2>Next</h2>
<p>See our <a href="tutorial-20-mfw-modifying.html">Saving Modifications to Station</a> tutorial.</p>
</article>

</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	bajaux Copyright © 2024 Tridium. DocStrap Copyright © 2012-2013 the contributors to the JSDoc3 and DocStrap projects.
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a>
	
		on 2024-05-03T00:28:54+00:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>